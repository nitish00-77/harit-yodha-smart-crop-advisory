<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рд╣рд░рд┐рдд - рдЖрдкрдХрд╛ рдХреГрд╖рд┐ рд╕рд╣рд╛рдпрдХ (Professional Prototype)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: linear-gradient(rgba(240, 253, 244, 0.97), rgba(240, 253, 244, 0.97)), url('https://images.unsplash.com/photo-1499529112087-7cb3b7874405?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .glass { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .assistant-btn-glow {
            box-shadow: 0 0 25px 10px rgba(34, 197, 94, 0.7);
            animation: pulse-glow 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 25px 10px rgba(34, 197, 94, 0.7); }
            50% { box-shadow: 0 0 15px 5px rgba(34, 197, 94, 0.4); }
        }
        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid #22c55e; border-radius: 50%;
            width: 32px; height: 32px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-backdrop { background-color: rgba(0,0,0,0.5); }
        .timeline { position: relative; padding: 1rem 0; }
        .timeline::before { content: ''; position: absolute; top: 0; left: 18px; height: 100%; width: 4px; background: #cbd5e1; }
        .timeline-item { position: relative; margin-bottom: 1.5rem; }
        .timeline-icon { position: absolute; left: 0; top: 0; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; color: white; z-index: 10; border: 4px solid #f0f9ff; }
        .timeline-content { margin-left: 60px; padding: 0.5rem 1rem; background: #f0f9ff; border-radius: 0.5rem; }
        .timeline-category { font-size: 0.75rem; font-weight: bold; text-transform: uppercase; color: #3b82f6; }
    </style>
</head>
<body class="bg-green-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-6xl font-bold text-green-800">рд╣рд░рд┐рдд - рдЖрдкрдХрд╛ рдХреГрд╖рд┐ рд╕рд╣рд╛рдпрдХ</h1>
            <p class="text-gray-600 mt-2 text-lg">рднрд╛рд░рдд рдХреЗ рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдкреВрд░реНрдг рдбрд┐рдЬрд┐рдЯрд▓ рд╕рдорд╛рдзрд╛рдиред</p>
        </header>

        <div id="messageBox" class="fixed top-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 text-white transition-opacity duration-300 opacity-0" role="alert"></div>

        <div class="text-center mb-10">
            <button id="assistantBtn" class="bg-green-600 text-white font-bold py-4 px-8 rounded-full shadow-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all duration-300 transform hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 inline-block mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z" /><path d="M5.5 11.5a4.5 4.5 0 009 0H16a6 6 0 01-12 0h1.5z" /><path d="M10 18a3 3 0 003-3h-1.5a1.5 1.5 0 01-3 0H7a3 3 0 003 3z" /></svg>
                рд╕рд╣рд╛рдпрдХ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ
            </button>
            <p id="status" class="mt-4 text-gray-600 h-6 transition-opacity duration-300"></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            
            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" /></svg>рдореМрд╕рдо рдФрд░ рд╕рд┐рдВрдЪрд╛рдИ рд╕рд▓рд╛рд╣</h2>
                <div class="flex gap-2 mb-4"><input type="text" id="cityInput" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="рд╢рд╣рд░ рдХрд╛ рдирд╛рдо"><button id="getWeatherBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">рдЦреЛрдЬреЗрдВ</button></div>
                <div id="weatherResult" class="text-gray-700 space-y-2"></div>
                <div id="irrigationAdvisory" class="mt-4"></div>
            </div>

            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>рд╡реНрдпрдХреНрддрд┐рдЧрдд рдлрд╕рд▓ рдХреИрд▓реЗрдВрдбрд░</h2>
                <div class="space-y-4">
                    <div><label for="calendarCrop" class="block mb-1 font-medium">рдлрд╕рд▓:</label><select id="calendarCrop" class="w-full p-2 border border-gray-300 rounded-lg"></select></div>
                    <div><label for="sowingDate" class="block mb-1 font-medium">рдмреБрд╡рд╛рдИ рдХреА рддрд╛рд░реАрдЦ:</label><input type="date" id="sowingDate" class="w-full p-2 border border-gray-300 rounded-lg"></div>
                    <button id="generateCalendarBtn" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">рдХреИрд▓реЗрдВрдбрд░ рдмрдирд╛рдПрдВ</button>
                </div>
            </div>

            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6H8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9" /></svg>рдлрд╕рд▓ рд╕реБрдЭрд╛рд╡</h2>
                <div class="space-y-4">
                    <div><label for="soilType" class="block mb-1 font-medium">рдорд┐рдЯреНрдЯреА рдХрд╛ рдкреНрд░рдХрд╛рд░:</label><select id="soilType" class="w-full p-2 border border-gray-300 rounded-lg"><option value="рдХрд╛рд▓реА">рдХрд╛рд▓реА</option><option value="рдЬрд▓реЛрдврд╝">рдЬрд▓реЛрдврд╝</option><option value="рд▓рд╛рд▓">рд▓рд╛рд▓</option><option value="рд▓реЗрдЯрд░рд╛рдЗрдЯ">рд▓реЗрдЯрд░рд╛рдЗрдЯ</option></select></div>
                    <div><label for="season" class="block mb-1 font-medium">рдореМрд╕рдо:</label><select id="season" class="w-full p-2 border border-gray-300 rounded-lg"><option value="рд░рдмреА">рд░рдмреА (рд╕рд░реНрджреА)</option><option value="рдЦрд░реАрдл">рдЦрд░реАрдл (рд╡рд░реНрд╖рд╛)</option><option value="рдЬрд╛рдпрдж">рдЬрд╛рдпрдж (рдЧрд░реНрдореА)</option></select></div>
                    <button id="getCropBtn" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">рд╕реБрдЭрд╛рд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</button>
                </div>
                <div id="cropResult" class="mt-4 text-gray-700"></div>
            </div>

            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7.014A8.003 8.003 0 0117.657 18.657z" /><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 16.121A3 3 0 1014.12 11.88a3 3 0 00-4.242 4.242z" /></svg>рдЦрд╛рдж рдФрд░ рдорд┐рдЯреНрдЯреА рд╕реНрд╡рд╛рд╕реНрдереНрдп</h2>
                 <div class="space-y-4">
                     <div><label for="fertilizerCrop" class="block mb-1 font-medium">рдлрд╕рд▓:</label><select id="fertilizerCrop" class="w-full p-2 border border-gray-300 rounded-lg"></select></div>
                    <button id="getFertilizerBtn" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</button>
                </div>
                <div id="fertilizerResult" class="mt-4 text-gray-700"></div>
            </div>
            
            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>рдкреМрдзреЗ рдХрд╛ рдирд┐рджрд╛рди</h2>
                <div class="space-y-4"><p class="text-gray-600">рдмреАрдорд╛рд░реА рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рдкреМрдзреЗ рдХрд╛ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред</p><input type="file" id="plantPhotoInput" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 transition"/><button id="diagnoseBtn" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">рдирд┐рджрд╛рди рдХрд░реЗрдВ</button><div id="diagnosisResult" class="mt-4 text-gray-700"></div></div>
            </div>

            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 8h6m-5 3h4m1 1l1 1h4l-1-1zm-6-3l-1-1H3l1 1zm-3 4h18a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v2a2 2 0 002 2z" /></svg>рдмрд╛рдЬрд╛рд░ рдореВрд▓реНрдп рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди</h2>
                <div class="space-y-4">
                    <div><label for="marketCropSelect" class="block mb-1 font-medium">рдлрд╕рд▓:</label><select id="marketCropSelect" class="w-full p-2 border border-gray-300 rounded-lg"></select></div>
                    <div><label for="cityInputMarket" class="block mb-1 font-medium">рд╢рд╣рд░:</label><input type="text" id="cityInputMarket" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="рдЙрджрд╛. рджрд┐рд▓реНрд▓реА"></div>
                    <button id="getMarketPriceBtn" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</button>
                </div>
                <div id="marketPriceResult" class="mt-4 text-gray-700"></div><div id="marketPricePrediction" class="mt-4 text-gray-700"></div>
            </div>
            
             <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>рдЙрдкрдЬ рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди</h2>
                <div class="space-y-4">
                    <div><label for="yieldCrop" class="block mb-1 font-medium">рдлрд╕рд▓:</label><select id="yieldCrop" class="w-full p-2 border border-gray-300 rounded-lg"></select></div>
                    <div><label for="farmSize" class="block mb-1 font-medium">рдЦреЗрдд рдХрд╛ рдЖрдХрд╛рд░ (рдПрдХрдбрд╝ рдореЗрдВ):</label><input type="number" id="farmSize" class="w-full p-2 border border-gray-300 rounded-lg" value="1"></div>
                    <button id="predictYieldBtn" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдПрдВ</button>
                </div>
                <div id="yieldResult" class="mt-4 text-gray-700"></div>
            </div>
            
            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>рдбрд┐рдЬрд┐рдЯрд▓ рдмрд╣реА-рдЦрд╛рддрд╛</h2>
                <div class="space-y-3">
                    <div class="text-center p-2 rounded-lg bg-green-100">
                        <p class="text-sm font-medium text-gray-600">рдХреБрд▓ рд▓рд╛рдн/рд╣рд╛рдирд┐</p>
                        <p id="profitText" class="text-2xl font-bold text-green-700">тВ╣ 0</p>
                    </div>
                    <input type="text" id="transactionDesc" placeholder="рд╡рд┐рд╡рд░рдг (рдЬреИрд╕реЗ рдмреАрдЬ, рдЦрд╛рдж)" class="w-full p-2 border rounded-lg">
                    <input type="number" id="transactionAmount" placeholder="рд░рд╛рд╢рд┐ (тВ╣)" class="w-full p-2 border rounded-lg">
                    <div class="flex gap-2">
                        <button id="addIncomeBtn" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">рдЖрдорджрдиреА рдЬреЛрдбрд╝реЗрдВ</button>
                        <button id="addExpenseBtn" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600">рдЦрд░реНрдЪ рдЬреЛрдбрд╝реЗрдВ</button>
                    </div>
                </div>
                <div id="transactionList" class="mt-4 text-sm max-h-24 overflow-y-auto"></div>
            </div>

            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10l2-2h8a1 1 0 001-1z" /><path stroke-linecap="round" stroke-linejoin="round" d="M20 18.35V19a2 2 0 01-2 2h-1a1 1 0 01-1-1v-2.65M18 5.65V5a2 2 0 00-2-2h-1a1 1 0 00-1 1v2.65" /></svg>рдЙрдкрдХрд░рдг рд░реЗрдВрдЯрд▓ рдмрд╛рдЬрд╛рд░</h2>
                <div class="space-y-3">
                    <div class="p-3 bg-gray-100 rounded-lg flex justify-between items-center"><div><p class="font-bold">рдЯреНрд░реИрдХреНрдЯрд░</p><p class="text-sm">тВ╣ 800 / рдШрдВрдЯрд╛</p></div><button class="bg-green-500 text-white px-3 py-1 text-sm rounded-lg" onclick="alert('рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ...')">рд╕рдВрдкрд░реНрдХ</button></div>
                    <div class="p-3 bg-gray-100 rounded-lg flex justify-between items-center"><div><p class="font-bold">рд░реЛрдЯрд╛рд╡реЗрдЯрд░</p><p class="text-sm">тВ╣ 600 / рдШрдВрдЯрд╛</p></div><button class="bg-green-500 text-white px-3 py-1 text-sm rounded-lg" onclick="alert('рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ...')">рд╕рдВрдкрд░реНрдХ</button></div>
                    <div class="p-3 bg-gray-100 rounded-lg flex justify-between items-center"><div><p class="font-bold">рдкрд╛рдиреА рдХрд╛ рдкрдВрдк</p><p class="text-sm">тВ╣ 200 / рджрд┐рди</p></div><button class="bg-green-500 text-white px-3 py-1 text-sm rounded-lg" onclick="alert('рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ...')">рд╕рдВрдкрд░реНрдХ</button></div>
                </div>
            </div>
            
            <div class="glass p-6 rounded-2xl shadow-md flex flex-col">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a2 2 0 01-2-2V10a2 2 0 012-2h8z" /></svg>рдХрд┐рд╕рд╛рди рд╕рдореБрджрд╛рдп рдордВрдЪ</h2>
                <div id="forumPosts" class="space-y-3 flex-grow overflow-y-auto max-h-48 mb-4">
                    <div class="p-3 bg-blue-50 rounded-lg"><p class="font-bold text-sm">рд░рд╛рдо рд╕рд┐рдВрд╣ рдиреЗ рдкреВрдЫрд╛:</p><p class="text-sm">"рдореЗрд░реА рдЯрдорд╛рдЯрд░ рдХреА рдлрд╕рд▓ рдореЗрдВ рдкрддреНрддрд┐рдпрд╛рдВ рд╕рд┐рдХреБрдбрд╝ рд░рд╣реА рд╣реИрдВ, рдХреНрдпрд╛ рдХрд░реВрдБ?"</p></div>
                    <div class="p-3 bg-green-50 rounded-lg ml-4"><p class="font-bold text-sm">рдХреГрд╖рд┐ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдиреЗ рдЬрд╡рд╛рдм рджрд┐рдпрд╛:</p><p class="text-sm">"рдпрд╣ рд▓реАрдл рдХрд░реНрд▓ рд╡рд╛рдпрд░рд╕ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЗрдорд┐рдбрд╛рдХреНрд▓реЛрдкреНрд░рд┐рдб рдХрд╛ рдЫрд┐рдбрд╝рдХрд╛рд╡ рдХрд░реЗрдВред"</p></div>
                </div>
                <div class="mt-auto space-y-2">
                    <textarea id="forumQuestion" class="w-full p-2 border rounded-lg" placeholder="рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдпрд╣рд╛рдБ рд▓рд┐рдЦреЗрдВ..." rows="2"></textarea>
                    <button id="postQuestionBtn" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ</button>
                </div>
            </div>

            <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ</h2>
                <div class="space-y-2 text-gray-700">
                    <div class="p-2 bg-green-50 rounded-lg"><h3 class="font-bold">PM-KISAN</h3><p class="text-sm">рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЛ рдкреНрд░рддрд┐ рд╡рд░реНрд╖ тВ╣6,000 рдХреА рд╡рд┐рддреНрддреАрдп рд╕рд╣рд╛рдпрддрд╛ред <a href="https://pmkisan.gov.in/" target="_blank" class="text-blue-600">рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ</a></p></div>
                    <div class="p-2 bg-green-50 rounded-lg"><h3 class="font-bold">PMFBY</h3><p class="text-sm">рдлрд╕рд▓ рдХреЗ рдиреБрдХрд╕рд╛рди рдкрд░ рдмреАрдорд╛ рдХрд╡рд░реЗрдЬред <a href="https://pmfby.gov.in/" target="_blank" class="text-blue-600">рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ</a></p></div>
                    <div class="p-2 bg-green-50 rounded-lg"><h3 class="font-bold">KCC</h3><p class="text-sm">рдХрдо рдмреНрдпрд╛рдЬ рджрд░ рдкрд░ рдХреГрд╖рд┐ рдЛрдгред <a href="https://www.sbi.co.in/web/agri-rural/agriculture-banking/crop-finance/kisan-credit-card" target="_blank" class="text-blue-600">рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ</a></p></div>
                </div>
            </div>
            
            <div class="glass p-6 rounded-2xl shadow-md">
                 <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди</h2>
                <div class="space-y-4">
                    <div><h3 class="font-bold">рдХрд┐рд╕рд╛рди рдХреЙрд▓ рд╕реЗрдВрдЯрд░</h3><p class="text-sm">рдХреГрд╖рд┐ рд╕рдВрдмрдВрдзреА рдХрд┐рд╕реА рднреА рдкреНрд░рд╢реНрди рдХреЗ рд▓рд┐рдПред<br><a href="tel:18001801551" class="font-semibold text-green-600">ЁЯУЮ 1800-180-1551</a></p></div>
                    <div><h3 class="font-bold">рдХреГрд╖рд┐ рдФрд░ рдХрд┐рд╕рд╛рди рдХрд▓реНрдпрд╛рдг</h3><p class="text-sm">рдордВрддреНрд░рд╛рд▓рдп рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рд▓рд┐рдПред<br><a href="tel:1800110039" class="font-semibold text-green-600">ЁЯУЮ 1800-11-0039</a></p></div>
                </div>
            </div>

             <div class="glass p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1h4v1m-4 0h-4v-1h4m0-4.03c-3.132 0-6 2.688-6 6s2.868 6 6 6 6-2.688 6-6-2.868-6-6-6z" /></svg>рдлрд╕рд▓ рдХреА рдХреБрд▓ рд▓рд╛рдЧрдд</h2>
                <div class="space-y-4">
                    <p class="text-gray-600">рдлрд╕рд▓ рдХреА рдЕрдиреБрдорд╛рдирд┐рдд рд▓рд╛рдЧрдд рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВред</p>
                    <button id="openCostCalculatorBtn" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">рд▓рд╛рдЧрдд рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ</button>
                </div>
            </div>

        </div>
    </div>

    <div id="calendarModal" class="fixed inset-0 z-50 modal-backdrop items-center justify-center p-4 hidden"><div class="glass w-full max-w-2xl rounded-2xl shadow-lg p-6 relative"><button id="closeCalendarModalBtn" class="absolute top-4 right-4 text-2xl font-bold text-gray-600 hover:text-gray-900">&times;</button><h2 id="modalTitle" class="text-2xl font-bold text-green-700 mb-4">рдлрд╕рд▓ рдХреИрд▓реЗрдВрдбрд░</h2><div id="modalContent" class="space-y-3 max-h-96 overflow-y-auto"></div></div></div>
    <div id="costCalculatorModal" class="fixed inset-0 z-50 modal-backdrop items-center justify-center p-4 hidden"><div class="glass w-full max-w-lg rounded-2xl shadow-lg p-6 relative"><button id="closeCostModalBtn" class="absolute top-4 right-4 text-2xl font-bold text-gray-600 hover:text-gray-900">&times;</button><h2 class="text-2xl font-bold text-green-700 mb-4">рдлрд╕рд▓ рд▓рд╛рдЧрдд рдХреИрд▓рдХреБрд▓реЗрдЯрд░</h2><div class="space-y-3"><div class="grid grid-cols-2 gap-4"><input type="number" id="cost_seed" placeholder="рдмреАрдЬ (тВ╣)" class="p-2 border rounded"><input type="number" id="cost_fertilizer" placeholder="рдЙрд░реНрд╡рд░рдХ (тВ╣)" class="p-2 border rounded"><input type="number" id="cost_pesticide" placeholder="рдХреАрдЯрдирд╛рд╢рдХ (тВ╣)" class="p-2 border rounded"><input type="number" id="cost_labor" placeholder="рд╢реНрд░рдо (тВ╣)" class="p-2 border rounded"><input type="number" id="cost_irrigation" placeholder="рд╕рд┐рдВрдЪрд╛рдИ (тВ╣)" class="p-2 border rounded"><input type="number" id="cost_other" placeholder="рдЕрдиреНрдп (тВ╣)" class="p-2 border rounded"></div><button id="calculateCostBtn" class="w-full bg-blue-500 text-white py-2 mt-4 rounded-lg">рдЧрдгрдирд╛ рдХрд░реЗрдВ</button><div id="totalCostResult" class="mt-4 text-center text-lg font-bold"></div></div></div></div>
    
<script>
document.addEventListener('DOMContentLoaded', () => {

    const ICONS = {
        irrigation: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM6.625 9.328a.75.75 0 01.04-1.06l.059-.059a.748.748 0 011.058.02L10 10.43l2.218-2.18a.748.748 0 011.058-.02l.059.059a.75.75 0 01.04 1.06l-2.25 2.25a.75.75 0 01-1.06 0l-2.25-2.25z" clip-rule="evenodd" /></svg>`,
        fertilizer: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 2zM5.106 5.106a.75.75 0 011.06 0l2.475 2.475a.75.75 0 01-1.06 1.06L5.106 6.166a.75.75 0 010-1.06zM2 10a.75.75 0 01.75-.75h3.5a.75.75 0 010 1.5h-3.5A.75.75 0 012 10zM14.894 5.106a.75.75 0 010 1.06l-2.475 2.475a.75.75 0 01-1.06-1.06L13.834 5.106a.75.75 0 011.06 0zM17.25 10a.75.75 0 01-.75.75h-3.5a.75.75 0 010-1.5h3.5a.75.75 0 01.75.75zM10 12a2 2 0 100 4 2 2 0 000-4zM5.106 14.894a.75.75 0 011.06 0l2.475-2.475a.75.75 0 011.06 1.06L6.166 14.894a.75.75 0 01-1.06 0zM14.894 14.894a.75.75 0 010-1.06l-2.475-2.475a.75.75 0 01-1.06 1.06l2.475 2.475a.75.75 0 010 1.06z" /></svg>`,
        pest_control: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.233 2.003a.75.75 0 01.22.13l5.5 5.5a.75.75 0 01-1.06 1.06L14 7.81V13a1 1 0 11-2 0V7.81l-.943.944a.75.75 0 11-1.06-1.06l2-2a.75.75 0 01.236-.13zm-6.5 1.5a.75.75 0 01.328-.623l5.5-3.5a.75.75 0 01.828.01l5.5 3.5a.75.75 0 01-.482 1.346L14 10.45V13a3 3 0 11-6 0v-2.55L6.425 8.19A.75.75 0 015 7.5v-2a.75.75 0 01.733-.747z" clip-rule="evenodd" /></svg>`,
        action: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1.5a.75.75 0 01.75.75V4h1.5a.75.75 0 010 1.5H12v1.5a.75.75 0 01-1.5 0V6h-1.5a.75.75 0 010-1.5H10V2.25A.75.75 0 0110 1.5zM5.878 6.122a.75.75 0 011.06 0l2.5 2.5a.75.75 0 010 1.06l-2.5 2.5a.75.75 0 01-1.06-1.06L7.81 9.25l-1.932-1.932a.75.75 0 010-1.06zM14.122 6.122a.75.75 0 010 1.06L12.19 9.25l1.932 1.932a.75.75 0 01-1.06 1.06l-2.5-2.5a.75.75 0 010-1.06l2.5-2.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg>`,
        harvest: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2.22 2.22a.75.75 0 011.06 0l14.5 14.5a.75.75 0 01-1.06 1.06L2.22 3.28a.75.75 0 010-1.06z" /><path d="M17.5 8.25a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H16V6a.75.75 0 011.5 0v2.25zM16 11.25a.75.75 0 01.75-.75h.75a.75.75 0 010 1.5h-.75a.75.75 0 01-.75-.75zM11.25 16a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H10V14a.75.75 0 011.5 0v2zM14 11.25a.75.75 0 01.75-.75h.75a.75.75 0 010 1.5h-.75a.75.75 0 01-.75-.75z" /></svg>`,
    };

    const fertilizerPrices = { "рдпреВрд░рд┐рдпрд╛": 9, "DAP": 48, "MOP (рдкреЛрдЯрд╛рд╢)": 28, "SSP": 15, "рд╕рд▓реНрдлрд░": 20, "рдЬрд┐рдкреНрд╕рдо": 10, "рдЬрд┐рдВрдХ рд╕рд▓реНрдлреЗрдЯ": 80, "рдмреЛрд░реЙрди": 150, "рдЧреЛрдмрд░ рдХреА рдЦрд╛рдж": 2, "рд╡рд░реНрдореАрдХрдореНрдкреЛрд╕реНрдЯ": 12 };

    const cropDatabase = {
        "рдЧреЗрд╣реВрдБ": { season: "рд░рдмреА", soil: "рдЬрд▓реЛрдврд╝,рдХрд╛рд▓реА", base_price: 2450, base_yield: 18, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:120},{n:"DAP",q:60},{n:"MOP (рдкреЛрдЯрд╛рд╢)",q:20}], sustainable: "рдЬреАрд░реЛ рдЯрд┐рд▓реЗрдЬ, рдлрд╕рд▓ рдЕрд╡рд╢реЗрд╖ рдкреНрд░рдмрдВрдзрдиред", calendar: [{w:0,c:"action",t:"рдЦреЗрдд рдХреА рддреИрдпрд╛рд░реА рдФрд░ рдкрд▓реЗрд╡рд╛"},{w:1,c:"action",t:"рдмреАрдЬреЛрдкрдЪрд╛рд░ рдПрд╡рдВ рдмреБрд╡рд╛рдИ"},{w:3,c:"irrigation",t:"рдкрд╣рд▓реА рд╕рд┐рдВрдЪрд╛рдИ (рддрд╛рдЬрдореВрд▓ рдЕрд╡рд╕реНрдерд╛)"},{w:6,c:"fertilizer",t:"рдпреВрд░рд┐рдпрд╛ рдХреА рдкрд╣рд▓реА рдЯреЙрдк рдбреНрд░реЗрд╕рд┐рдВрдЧ"},{w:9,c:"pest_control",t:"рдЦрд░рдкрддрд╡рд╛рд░ рдирд┐рдпрдВрддреНрд░рдг"},{w:12,c:"irrigation",t:"рдмрд╛рд▓рд┐рдпрд╛рдБ рдирд┐рдХрд▓рдиреЗ рдкрд░ рд╕рд┐рдВрдЪрд╛рдИ"},{w:20,c:"harvest",t:"рдХрдЯрд╛рдИ рдФрд░ рдЧрд╣рд╛рдИ"}]},
        "рдзрд╛рди": { season: "рдЦрд░реАрдл", soil: "рдЬрд▓реЛрдврд╝,рдХрд╛рд▓реА,рд▓рд╛рд▓", base_price: 2100, base_yield: 22, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:100},{n:"DAP",q:50},{n:"рдЬрд┐рдВрдХ рд╕рд▓реНрдлреЗрдЯ",q:10}], sustainable: "рд╕реАрдзреА рдмрд┐рдЬрд╛рдИ (DSR), рдиреАрдо рд▓реЗрдкрд┐рдд рдпреВрд░рд┐рдпрд╛ред", calendar: [{w:0,c:"action",t:"рдирд░реНрд╕рд░реА рдХреА рддреИрдпрд╛рд░реА"},{w:3,c:"action",t:"рдЦреЗрдд рдХреА рдордЪрд╛рдИ рдФрд░ рд░реЛрдкрд╛рдИ"},{w:4,c:"pest_control",t:"рдЦрд░рдкрддрд╡рд╛рд░рдирд╛рд╢рдХ рдХрд╛ рдкреНрд░рдпреЛрдЧ"},{w:6,c:"fertilizer",t:"рдпреВрд░рд┐рдпрд╛ рдХреА рдЯреЙрдк рдбреНрд░реЗрд╕рд┐рдВрдЧ"},{w:10,c:"pest_control",t:"рддрдирд╛ рдЫреЗрджрдХ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:16,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рдордХреНрдХрд╛": { season: "рдЦрд░реАрдл,рдЬрд╛рдпрдж", soil: "рдЬрд▓реЛрдврд╝,рд▓рд╛рд▓,рд▓реЗрдЯрд░рд╛рдЗрдЯ", base_price: 2200, base_yield: 25, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:80},{n:"DAP",q:50}], sustainable: "рджрд▓рд╣рдиреА рдлрд╕рд▓реЛрдВ рдХреЗ рд╕рд╛рде рд╕рд╣-рдлрд╕рд▓реАред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:4,c:"irrigation",t:"рдШреБрдЯрдиреЗ рддрдХ рдХреА рдЕрд╡рд╕реНрдерд╛ рдореЗрдВ рд╕рд┐рдВрдЪрд╛рдИ"},{w:5,c:"fertilizer",t:"рдирд╛рдЗрдЯреНрд░реЛрдЬрди рдХреА рдЯреЙрдк рдбреНрд░реЗрд╕рд┐рдВрдЧ"},{w:9,c:"pest_control",t:"рдлреЙрд▓ рдЖрд░реНрдореАрд╡рд░реНрдо рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:18,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рдЪрдирд╛": { season: "рд░рдмреА", soil: "рдХрд╛рд▓реА,рдЬрд▓реЛрдврд╝", base_price: 5500, base_yield: 8, fertilizer: [{n:"DAP",q:40},{n:"рд╕рд▓реНрдлрд░",q:8}], sustainable: "рд░рд╛рдЗрдЬреЛрдмрд┐рдпрдо рдХрд▓реНрдЪрд░ рд╕реЗ рдмреАрдЬреЛрдкрдЪрд╛рд░ рдХрд░реЗрдВред", calendar: [{w:1,c:"action",t:"рд░рд╛рдЗрдЬреЛрдмрд┐рдпрдо рд╕реЗ рдмреАрдЬреЛрдкрдЪрд╛рд░ рд╡ рдмреБрд╡рд╛рдИ"},{w:6,c:"irrigation",t:"рдлреВрд▓ рдЖрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕рд┐рдВрдЪрд╛рдИ"},{w:12,c:"pest_control",t:"рдлрд▓реА рдЫреЗрджрдХ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:22,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рд╕рд░рд╕реЛрдВ": { season: "рд░рдмреА", soil: "рдЬрд▓реЛрдврд╝,рд▓реЗрдЯрд░рд╛рдЗрдЯ", base_price: 5800, base_yield: 10, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:70},{n:"SSP",q:100},{n:"рд╕рд▓реНрдлрд░",q:10}], sustainable: "рдордзреБрдордХреНрдЦреА рдкрд╛рд▓рди рд╕реЗ рдкрд░рд╛рдЧрдг рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдВред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:5,c:"action",t:"рдШрдиреА рдлрд╕рд▓ рдХреА рдЫрдБрдЯрд╛рдИ"},{w:7,c:"irrigation",t:"рдлреВрд▓ рдЖрдиреЗ рдкрд░ рд╕рд┐рдВрдЪрд╛рдИ"},{w:11,c:"pest_control",t:"рдорд╛рд╣реВ (рдПрдлрд┐рдб) рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:20,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рдХрдкрд╛рд╕": { season: "рдЦрд░реАрдл", soil: "рдХрд╛рд▓реА,рдЬрд▓реЛрдврд╝", base_price: 7100, base_yield: 7, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:90},{n:"DAP",q:50},{n:"MOP (рдкреЛрдЯрд╛рд╢)",q:25}], sustainable: "рдлреЗрд░реЛрдореЛрди рдЯреНрд░реИрдк рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:9,c:"pest_control",t:"рдЧреБрд▓рд╛рдмреА рд╕реБрдВрдбреА рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:12,c:"fertilizer",t:"рдлреВрд▓ рдЖрдиреЗ рдкрд░ рдпреВрд░рд┐рдпрд╛ рдХреА рдЦреБрд░рд╛рдХ"},{w:25,c:"harvest",t:"рдкрд╣рд▓реА рдЪреБрдирд╛рдИ"}]},
        "рдЯрдорд╛рдЯрд░": { season: "рд░рдмреА,рдЬрд╛рдпрдж", soil: "рдЬрд▓реЛрдврд╝,рд▓рд╛рд▓,рдХрд╛рд▓реА", base_price: 2500, base_yield: 150, fertilizer: [{n:"рд╡рд░реНрдореАрдХрдореНрдкреЛрд╕реНрдЯ",q:1000},{n:"DAP",q:60},{n:"MOP (рдкреЛрдЯрд╛рд╢)",q:40}], sustainable: "рдорд▓реНрдЪрд┐рдВрдЧ рдФрд░ рдбреНрд░рд┐рдк рдЗрд░рд┐рдЧреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧред", calendar: [{w:0,c:"action",t:"рдирд░реНрд╕рд░реА рддреИрдпрд╛рд░ рдХрд░рдирд╛"},{w:4,c:"action",t:"рдЦреЗрдд рдореЗрдВ рд░реЛрдкрд╛рдИ рдФрд░ рд╕рд╣рд╛рд░рд╛ рджреЗрдирд╛"},{w:6,c:"pest_control",t:"рдлрд▓ рдЫреЗрджрдХ рдХреАрдЯ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:9,c:"fertilizer",t:"рдкреЛрдЯрд╛рд╢ рдХреА рдЯреЙрдк рдбреНрд░реЗрд╕рд┐рдВрдЧ"},{w:12,c:"harvest",t:"рдкрд╣рд▓реА рддреБрдбрд╝рд╛рдИ"}]},
        "рдкреНрдпрд╛рдЬ": { season: "рд░рдмреА,рдЦрд░реАрдл", soil: "рдЬрд▓реЛрдврд╝,рд▓рд╛рд▓", base_price: 3200, base_yield: 120, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:80},{n:"SSP",q:120},{n:"MOP (рдкреЛрдЯрд╛рд╢)",q:40}], sustainable: "рднрдВрдбрд╛рд░рдг рдореЗрдВ рдиреБрдХрд╕рд╛рди рдХрдо рдХрд░рдиреЗ рдХреЗ рдЙрдкрд╛рдпред", calendar: [{w:0,c:"action",t:"рдирд░реНрд╕рд░реА рдореЗрдВ рдмреАрдЬ рдбрд╛рд▓рдирд╛"},{w:6,c:"action",t:"рдЦреЗрдд рдореЗрдВ рд░реЛрдкрд╛рдИ"},{w:10,c:"pest_control",t:"рдереНрд░рд┐рдкреНрд╕ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:20,c:"harvest",t:"рдЦреБрджрд╛рдИ рдФрд░ рд╕реБрдЦрд╛рдирд╛"}]},
        "рдЖрд▓реВ": { season: "рд░рдмреА", soil: "рдЬрд▓реЛрдврд╝,рд▓реЗрдЯрд░рд╛рдЗрдЯ", base_price: 1800, base_yield: 130, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:120},{n:"DAP",q:80},{n:"MOP (рдкреЛрдЯрд╛рд╢)",q:50}], sustainable: "рдЕрдЧреЗрддреА рдФрд░ рдкрдЫреЗрддреА рдЭреБрд▓рд╕рд╛ рдХрд╛ рдкреНрд░рдмрдВрдзрдиред", calendar: [{w:1,c:"action",t:"рдХрдВрдж рдЙрдкрдЪрд╛рд░ рдФрд░ рдмреБрд╡рд╛рдИ"},{w:5,c:"action",t:"рдорд┐рдЯреНрдЯреА рдЪрдврд╝рд╛рдирд╛ (Earthing up)"},{w:8,c:"pest_control",t:"рдкрдЫреЗрддреА рдЭреБрд▓рд╕рд╛ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:15,c:"harvest",t:"рдЦреБрджрд╛рдИ"}]},
        "рдЧрдиреНрдирд╛": { season: "рдЦрд░реАрдл,рдЬрд╛рдпрдж", soil: "рдХрд╛рд▓реА,рдЬрд▓реЛрдврд╝,рд▓рд╛рд▓", base_price: 350, base_yield: 400, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:150},{n:"SSP",q:200}], sustainable: "рд╕рд╣рдлрд╕рд▓реА рдЦреЗрддреА (рдЬреИрд╕реЗ рдкреНрдпрд╛рдЬ, рд▓рд╣рд╕реБрди)ред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:8,c:"pest_control",t:"рдЦрд░рдкрддрд╡рд╛рд░ рдирд┐рдпрдВрддреНрд░рдг"},{w:16,c:"action",t:"рдЧрдиреНрдиреЗ рдХреА рдмрдВрдзрд╛рдИ"},{w:48,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рд╕реЛрдпрд╛рдмреАрди": { season: "рдЦрд░реАрдл", soil: "рдХрд╛рд▓реА,рдЬрд▓реЛрдврд╝", base_price: 4800, base_yield: 10, fertilizer: [{n:"SSP",q:120},{n:"MOP (рдкреЛрдЯрд╛рд╢)",q:20}], sustainable: "рд░рд┐рдЬ-рдлрд░реЛ рд╡рд┐рдзрд┐ рд╕реЗ рдмреБрд╡рд╛рдИред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:5,c:"pest_control",t:"рдЧрд░реНрдбрд▓ рдмреАрдЯрд▓ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:16,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рдореВрдВрдЧрдлрд▓реА": { season: "рдЦрд░реАрдл,рдЬрд╛рдпрдж", soil: "рд▓рд╛рд▓,рд▓реЗрдЯрд░рд╛рдЗрдЯ,рдЬрд▓реЛрдврд╝", base_price: 6000, base_yield: 9, fertilizer: [{n:"рдЬрд┐рдкреНрд╕рдо",q:100},{n:"SSP",q:100}], sustainable: "рдХреИрд▓реНрд╢рд┐рдпрдо рдХреА рдкреВрд░реНрддрд┐ рд╣реЗрддреБ рдЬрд┐рдкреНрд╕рдо рдХрд╛ рдкреНрд░рдпреЛрдЧред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:6,c:"fertilizer",t:"рдлреВрд▓ рдЖрдиреЗ рдкрд░ рдЬрд┐рдкреНрд╕рдо рдбрд╛рд▓рдирд╛"},{w:18,c:"harvest",t:"рдЦреБрджрд╛рдИ"}]},
        "рдмрд╛рдЬрд░рд╛": { season: "рдЦрд░реАрдл", soil: "рд▓реЗрдЯрд░рд╛рдЗрдЯ,рдЬрд▓реЛрдврд╝", base_price: 2300, base_yield: 9, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:40},{n:"SSP",q:60}], sustainable: "рдХрдо рдкрд╛рдиреА рдореЗрдВ рдЙрдЧрдиреЗ рд╡рд╛рд▓реА рдХрд┐рд╕реНрдореЛрдВ рдХрд╛ рдЪрдпрдиред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:5,c:"pest_control",t:"рддрдирд╛ рдордХреНрдЦреА рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:15,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рдЬреНрд╡рд╛рд░": { season: "рдЦрд░реАрдл", soil: "рдХрд╛рд▓реА,рд▓рд╛рд▓", base_price: 2200, base_yield: 12, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:50},{n:"SSP",q:80}], sustainable: "рдЪрд╛рд░реЗ рдФрд░ рджрд╛рдиреЗ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:6,c:"pest_control",t:"рдкреНрд░рд░реЛрд╣ рдордХреНрдЦреА рдХрд╛ рдирд┐рдпрдВрддреНрд░рдг"},{w:18,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рдореВрдВрдЧ": { season: "рдЦрд░реАрдл,рдЬрд╛рдпрдж", soil: "рдЬрд▓реЛрдврд╝,рдХрд╛рд▓реА", base_price: 7500, base_yield: 5, fertilizer: [{n:"DAP",q:40}], sustainable: "рдлрд╕рд▓ рдЪрдХреНрд░ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╕реЗ рдорд┐рдЯреНрдЯреА рдХрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╕реБрдзрд░рддрд╛ рд╣реИред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:5,c:"pest_control",t:"рдкреАрд▓рд╛ рдореЛрдЬреЗрдХ рд░реЛрдЧ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:10,c:"harvest",t:"рдкрд╣рд▓реА рддреБрдбрд╝рд╛рдИ"}]},
        "рдорд┐рд░реНрдЪ": { season: "рдЦрд░реАрдл,рдЬрд╛рдпрдж", soil: "рд▓рд╛рд▓,рдХрд╛рд▓реА,рдЬрд▓реЛрдврд╝", base_price: 8000, base_yield: 60, fertilizer: [{n:"рд╡рд░реНрдореАрдХрдореНрдкреЛрд╕реНрдЯ",q:800},{n:"MOP (рдкреЛрдЯрд╛рд╢)",q:30}], sustainable: "рдПрдлрд┐рдбреНрд╕ рдХреЗ рд▓рд┐рдП рд╕реНрдЯрд┐рдХреА рдЯреНрд░реИрдк рдХрд╛ рдЙрдкрдпреЛрдЧред", calendar: [{w:0,c:"action",t:"рдирд░реНрд╕рд░реА рдХреА рддреИрдпрд╛рд░реА"},{w:5,c:"action",t:"рд░реЛрдкрд╛рдИ"},{w:9,c:"pest_control",t:"рдереНрд░рд┐рдкреНрд╕ рдФрд░ рдорд╛рдЗрдЯреНрд╕ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:14,c:"harvest",t:"рдкрд╣рд▓реА рддреБрдбрд╝рд╛рдИ"}]},
        "рд╣рд▓реНрджреА": { season: "рдЦрд░реАрдл", soil: "рд▓рд╛рд▓,рд▓реЗрдЯрд░рд╛рдЗрдЯ", base_price: 9000, base_yield: 80, fertilizer: [{n:"рдЧреЛрдмрд░ рдХреА рдЦрд╛рдж",q:4000},{n:"рдпреВрд░рд┐рдпрд╛",q:60}], sustainable: "рдЫрд╛рдпрд╛рджрд╛рд░ рдЬрдЧрд╣ рдореЗрдВ рдЙрдЧрд╛рдирд╛ рдлрд╛рдпрджреЗрдордВрджред", calendar: [{w:1,c:"action",t:"рдХрдВрдж рдХреА рдмреБрд╡рд╛рдИ"},{w:8,c:"action",t:"рдорд┐рдЯреНрдЯреА рдЪрдврд╝рд╛рдирд╛"},{w:36,c:"harvest",t:"рдЦреБрджрд╛рдИ рдФрд░ рдЙрдмрд╛рд▓рдирд╛"}]},
        "рд▓рд╣рд╕реБрди": { season: "рд░рдмреА", soil: "рдЬрд▓реЛрдврд╝,рдХрд╛рд▓реА", base_price: 12000, base_yield: 40, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:50},{n:"SSP",q:100}], sustainable: "рдЬреИрд╡рд┐рдХ рдХреАрдЯрдирд╛рд╢рдХреЛрдВ рдХрд╛ рдкреНрд░рдпреЛрдЧред", calendar: [{w:1,c:"action",t:"рдХрд▓рд┐рдпреЛрдВ рдХреА рдмреБрд╡рд╛рдИ"},{w:6,c:"irrigation",t:"рд╕рд┐рдВрдЪрд╛рдИ"},{w:20,c:"harvest",t:"рдЦреБрджрд╛рдИ"}]},
        "рдХреЗрд▓рд╛": { season: "рдЦрд░реАрдл", soil: "рдЬрд▓реЛрдврд╝,рд▓рд╛рд▓", base_price: 1500, base_yield: 300, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:100},{n:"MOP (рдкреЛрдЯрд╛рд╢)",q:120}], sustainable: "рдбреНрд░рд┐рдк рд╕рд┐рдВрдЪрд╛рдИ рдФрд░ рдлрд░реНрдЯрд┐рдЧреЗрд╢рдиред", calendar: [{w:1,c:"action",t:"рдкреМрдзреЛрдВ рдХреА рд░реЛрдкрд╛рдИ"},{w:16,c:"action",t:"рд╕рд╣рд╛рд░рд╛ рджреЗрдирд╛ (Propping)"},{w:40,c:"harvest",t:"рдШрд╛рд░ рдХреА рдХрдЯрд╛рдИ"}]},
        "рдкрдкреАрддрд╛": { season: "рдЦрд░реАрдл,рдЬрд╛рдпрдж", soil: "рдЬрд▓реЛрдврд╝,рд▓рд╛рд▓", base_price: 2000, base_yield: 400, fertilizer: [{n:"рдЧреЛрдмрд░ рдХреА рдЦрд╛рдж",q:2000},{n:"рдпреВрд░рд┐рдпрд╛",q:80}], sustainable: "рд░рд┐рдВрдЧ рд╕реНрдкреЙрдЯ рд╡рд╛рдпрд░рд╕ рд╕реЗ рдмрдЪрд╛рд╡ред", calendar: [{w:1,c:"action",t:"рд░реЛрдкрд╛рдИ"},{w:20,c:"pest_control",t:"рдорд┐рд▓рд┐рдмрдЧ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:36,c:"harvest",t:"рдлрд▓реЛрдВ рдХреА рддреБрдбрд╝рд╛рдИ"}]},
        "рдмреИрдВрдЧрди": { season: "рдЦрд░реАрдл,рдЬрд╛рдпрдж,рд░рдмреА", soil: "рдЬрд▓реЛрдврд╝,рдХрд╛рд▓реА", base_price: 1800, base_yield: 140, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:60},{n:"SSP",q:100}], sustainable: "рддрдирд╛ рдФрд░ рдлрд▓ рдЫреЗрджрдХ рдХреЗ рд▓рд┐рдП рдлреЗрд░реЛрдореЛрди рдЯреНрд░реИрдкред", calendar: [{w:0,c:"action",t:"рдирд░реНрд╕рд░реА"},{w:5,c:"action",t:"рд░реЛрдкрд╛рдИ"},{w:10,c:"pest_control",t:"рддрдирд╛ рдЫреЗрджрдХ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:14,c:"harvest",t:"рдкрд╣рд▓реА рддреБрдбрд╝рд╛рдИ"}]},
        "рднрд┐рдВрдбреА": { season: "рдЦрд░реАрдл,рдЬрд╛рдпрдж", soil: "рдЬрд▓реЛрдврд╝,рд▓рд╛рд▓", base_price: 2500, base_yield: 50, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:40},{n:"DAP",q:40}], sustainable: "рдкреАрд▓рд╛ рдореЛрдЬреЗрдХ рдкреНрд░рддрд┐рд░реЛрдзреА рдХрд┐рд╕реНрдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧред", calendar: [{w:1,c:"action",t:"рдмреБрд╡рд╛рдИ"},{w:5,c:"pest_control",t:"рд╕рдлреЗрдж рдордХреНрдЦреА рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:8,c:"harvest",t:"рддреБрдбрд╝рд╛рдИ рд╢реБрд░реВ"}]},
        "рдкрддреНрддрд╛ рдЧреЛрднреА": { season: "рд░рдмреА", soil: "рдЬрд▓реЛрдврд╝,рдХрд╛рд▓реА", base_price: 1200, base_yield: 120, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:80},{n:"DAP",q:60},{n:"рдмреЛрд░реЙрди",q:2}], sustainable: "рдбрд╛рдпрдордВрдб рдмреИрдХ рдореЛрде рдХреЗ рд▓рд┐рдП рдЬреИрд╡рд┐рдХ рдирд┐рдпрдВрддреНрд░рдгред", calendar: [{w:0,c:"action",t:"рдирд░реНрд╕рд░реА"},{w:4,c:"action",t:"рд░реЛрдкрд╛рдИ"},{w:8,c:"pest_control",t:"рд╕реБрдВрдбреА рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:12,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рдлреВрд▓рдЧреЛрднреА": { season: "рд░рдмреА", soil: "рдЬрд▓реЛрдврд╝,рд▓рд╛рд▓", base_price: 1500, base_yield: 100, fertilizer: [{n:"рдпреВрд░рд┐рдпрд╛",q:70},{n:"SSP",q:120},{n:"рдмреЛрд░реЙрди",q:2}], sustainable: "рдмреЛрд░реЙрди рдХреА рдХрдореА рд╕реЗ рдмрдЪрд╛рд╡ред", calendar: [{w:0,c:"action",t:"рдирд░реНрд╕рд░реА"},{w:4,c:"action",t:"рд░реЛрдкрд╛рдИ"},{w:9,c:"action",t:"рдмреНрд▓рд╛рдВрдЪрд┐рдВрдЧ (рдлреВрд▓ рдХреЛ рдврдХрдирд╛)"},{w:13,c:"harvest",t:"рдХрдЯрд╛рдИ"}]},
        "рдЧреБрд▓рд╛рдм": { season: "рд░рдмреА", soil: "рдЬрд▓реЛрдврд╝,рдХрд╛рд▓реА", base_price: 1500, base_yield: 50, fertilizer: [{n:"рд╡рд░реНрдореАрдХрдореНрдкреЛрд╕реНрдЯ", q:500},{n:"DAP", q:20}], sustainable: "рдирд┐рдпрдорд┐рдд рдХрдЯрд╛рдИ-рдЫрдВрдЯрд╛рдИ рдФрд░ рд░реЛрдЧ рдкреНрд░рдмрдВрдзрдиред", calendar: [{w:1,c:"action",t:"рдЫрдВрдЯрд╛рдИ (Pruning)"},{w:7,c:"pest_control", t:"рдкрд╛рдЙрдбрд░реА рдорд┐рд▓реНрдбреНрдпреВ рдХреА рдирд┐рдЧрд░рд╛рдиреА"},{w:10,c:"harvest",t:"рдлреВрд▓реЛрдВ рдХреА рддреБрдбрд╝рд╛рдИ"}]}
    };
    
    const allElements = {
        cityInput: document.getElementById('cityInput'),
        getWeatherBtn: document.getElementById('getWeatherBtn'),
        weatherResult: document.getElementById('weatherResult'),
        irrigationAdvisory: document.getElementById('irrigationAdvisory'),
        getCropBtn: document.getElementById('getCropBtn'),
        cropResult: document.getElementById('cropResult'),
        diagnoseBtn: document.getElementById('diagnoseBtn'),
        diagnosisResult: document.getElementById('diagnosisResult'),
        getMarketPriceBtn: document.getElementById('getMarketPriceBtn'),
        marketPriceResult: document.getElementById('marketPriceResult'),
        predictYieldBtn: document.getElementById('predictYieldBtn'),
        yieldResult: document.getElementById('yieldResult'),
        addIncomeBtn: document.getElementById('addIncomeBtn'),
        addExpenseBtn: document.getElementById('addExpenseBtn'),
        profitText: document.getElementById('profitText'),
        transactionList: document.getElementById('transactionList'),
        postQuestionBtn: document.getElementById('postQuestionBtn'),
        forumPosts: document.getElementById('forumPosts'),
        getFertilizerBtn: document.getElementById('getFertilizerBtn'),
        fertilizerResult: document.getElementById('fertilizerResult'),
        generateCalendarBtn: document.getElementById('generateCalendarBtn'),
        openCostCalculatorBtn: document.getElementById('openCostCalculatorBtn'),
        costCalculatorModal: document.getElementById('costCalculatorModal'),
        closeCostModalBtn: document.getElementById('closeCostModalBtn'),
        calculateCostBtn: document.getElementById('calculateCostBtn'),
        totalCostResult: document.getElementById('totalCostResult'),
        calendarModal: document.getElementById('calendarModal'),
        closeCalendarModalBtn: document.getElementById('closeCalendarModalBtn'),
        modalContent: document.getElementById('modalContent'),
        modalTitle: document.getElementById('modalTitle'),
        assistantBtn: document.getElementById('assistantBtn'),
        status: document.getElementById('status'),
    };
    
    let ledger = [];
    
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.lang = 'hi-IN';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
    }
    let isListening = false;
    let synth = window.speechSynthesis;

    function speak(text) {
        if (synth.speaking) {
            synth.cancel();
        }
        const utterThis = new SpeechSynthesisUtterance(text);
        utterThis.lang = 'hi-IN';
        utterThis.pitch = 1;
        utterThis.rate = 1;
        synth.speak(utterThis);
    }

    function showMessage(text, type = 'info') {
        const box = document.getElementById('messageBox');
        box.textContent = text;
        const colors = { info: 'bg-blue-500', success: 'bg-green-500', error: 'bg-red-500', warning: 'bg-yellow-500' };
        box.className = `fixed top-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 text-white transition-opacity duration-300 opacity-100 ${colors[type]}`;
        setTimeout(() => { box.style.opacity = '0'; }, 3000);
    }
    
    function populateDropdowns() {
        const cropNames = Object.keys(cropDatabase).sort();
        const selects = [
            document.getElementById('calendarCrop'), document.getElementById('marketCropSelect'),
            document.getElementById('yieldCrop'), document.getElementById('fertilizerCrop')
        ];
        selects.forEach(select => {
            if(select) {
                select.innerHTML = '';
                cropNames.forEach(crop => {
                    const option = document.createElement('option');
                    option.value = crop; option.textContent = crop;
                    select.appendChild(option);
                });
            }
        });
    }

    const fetchWeather = async (cityOverride = null) => {
        const city = cityOverride || allElements.cityInput.value.trim();
        if (!city) {
            showMessage("рдХреГрдкрдпрд╛ рд╢рд╣рд░ рдХрд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВред", "error");
            return;
        }
        allElements.weatherResult.innerHTML = `<div class="flex justify-center"><div class="loader"></div></div>`;
        allElements.irrigationAdvisory.innerHTML = '';
        allElements.cityInput.value = city;
        
        try {
            const API_KEY = "2aa75c3847bdda09f365c8b688902505"; // Demo key
            const [weatherResponse, forecastResponse] = await Promise.all([
                fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric&lang=hi`),
                fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${API_KEY}&units=metric&lang=hi`)
            ]);

            if (!weatherResponse.ok || !forecastResponse.ok) throw new Error("API request failed");
            
            const weatherData = await weatherResponse.json();
            const forecastData = await forecastResponse.json();
            
            processWeatherData(weatherData);
            processForecastData(forecastData);

        } catch (error) {
            console.warn("Live API failed, using simulated data.", error);
            showMessage("рд▓рд╛рдЗрд╡ рдбреЗрдЯрд╛ рд╡рд┐рдлрд▓, рд╕рд┐рдореНрдпреБрд▓реЗрдЯреЗрдб рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред", "warning");
            setTimeout(() => {
                const simulatedWeather = { name: city, main: { temp: 31.5 }, weather: [{ description: "рдзреВрдк", icon: "01d" }], rain: null };
                const simulatedForecast = { list: [
                    { dt_txt: "2025-09-29 12:00:00", main: { temp_max: 32, temp_min: 25 }, weather: [{ icon: '02d' }] },
                    { dt_txt: "2025-09-30 12:00:00", main: { temp_max: 33, temp_min: 26 }, weather: [{ icon: '01d' }] },
                    { dt_txt: "2025-10-01 12:00:00", main: { temp_max: 31, temp_min: 24 }, weather: [{ icon: '10d' }] },
                    { dt_txt: "2025-10-02 12:00:00", main: { temp_max: 30, temp_min: 23 }, weather: [{ icon: '04d' }] },
                    { dt_txt: "2025-10-03 12:00:00", main: { temp_max: 32, temp_min: 25 }, weather: [{ icon: '01d' }] }
                ]};
                processWeatherData(simulatedWeather);
                processForecastData(simulatedForecast);
            }, 1000);
        }
    };
    
    function processWeatherData(data) {
        allElements.weatherResult.innerHTML = `<div class="p-3 bg-blue-50 rounded-lg">
            <h4 class="font-bold text-lg text-blue-800">${data.name}</h4>
            <div class="flex items-center gap-2">
                <img src="https://openweathermap.org/img/wn/${data.weather[0].icon}.png" alt="weather icon" class="h-10 w-10">
                <p class="text-2xl font-semibold">${data.main.temp.toFixed(1)}┬░C</p>
                <p>${data.weather[0].description}</p>
            </div>
        </div>
        <div id="forecastResult" class="mt-4"></div>`;
        
        let irrigationText = '';
        if (data.main.temp > 32 && (!data.rain || !data.rain['1h'])) {
            irrigationText = 'рддрд╛рдкрдорд╛рди рдЕрдзрд┐рдХ рд╣реИ рдФрд░ рдмрд╛рд░рд┐рд╢ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрдо рд╣реИред рдЦреЗрдд рдореЗрдВ рдирдореА рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдФрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛рдиреБрд╕рд╛рд░ рд╕рд┐рдВрдЪрд╛рдИ рдХрд░реЗрдВред';
        } else if (data.rain && data.rain['1h'] > 5) {
            irrigationText = 'рднрд╛рд░реА рдмрд╛рд░рд┐рд╢ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред рдЕрднреА рд╕рд┐рдВрдЪрд╛рдИ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред рдЬрд▓ рдирд┐рдХрд╛рд╕реА рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░реЗрдВред';
        } else {
            irrigationText = 'рдореМрд╕рдо рд╕рд╛рдорд╛рдиреНрдп рд╣реИред рдорд┐рдЯреНрдЯреА рдХреА рдирдореА рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕рд┐рдВрдЪрд╛рдИ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрдВред';
        }
        allElements.irrigationAdvisory.innerHTML = `<div class="p-3 bg-indigo-50 rounded-lg mt-2"><p class="font-bold text-indigo-800">рд╕рд┐рдВрдЪрд╛рдИ рд╕рд▓рд╛рд╣:</p><p class="text-sm">${irrigationText}</p></div>`;
    }

    function processForecastData(data) {
        const forecastResult = document.getElementById('forecastResult');
        if (!forecastResult) return;
        
        const dailyData = data.list.filter(item => item.dt_txt.includes("12:00:00"));

        let forecastHtml = `<h4 class="font-bold text-gray-700 mb-2">рдЕрдЧрд▓реЗ 5 рджрд┐рдиреЛрдВ рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди:</h4><div class="grid grid-cols-5 gap-1 text-center">`;
        dailyData.slice(0, 5).forEach(day => {
            const date = new Date(day.dt_txt);
            const dayName = date.toLocaleDateString('hi-IN', { weekday: 'short' });
            forecastHtml += `<div class="p-1 bg-gray-100 rounded">
                <p class="font-semibold text-sm">${dayName}</p>
                <img src="https://openweathermap.org/img/wn/${day.weather[0].icon}.png" alt="icon" class="mx-auto h-8 w-8">
                <p class="text-xs">${day.main.temp_max.toFixed(0)}┬░/${day.main.temp_min.toFixed(0)}┬░</p>
            </div>`;
        });
        forecastHtml += `</div>`;
        forecastResult.innerHTML = forecastHtml;
    }

    const getCropAdvice = (soilOverride = null, seasonOverride = null) => {
        const soil = soilOverride || document.getElementById('soilType').value;
        const season = seasonOverride || document.getElementById('season').value;

        if(soilOverride) document.getElementById('soilType').value = soilOverride;
        if(seasonOverride) document.getElementById('season').value = seasonOverride;

        const suggestedCrops = Object.keys(cropDatabase).filter(crop => {
            const data = cropDatabase[crop];
            return data.soil.includes(soil) && data.season.includes(season);
        });

        if (suggestedCrops.length > 0) {
            const resultText = `рд╕реБрдЭрд╛рдП рдЧрдП рдлрд╕рд▓реЗрдВ рд╣реИрдВ: ${suggestedCrops.join(', ')}`;
            allElements.cropResult.innerHTML = `<p class="font-bold">рдЖрдкрдХреЗ рд▓рд┐рдП рд╕реБрдЭрд╛рдП рдЧрдП рдлрд╕рд▓реЗрдВ:</p><ul class="list-disc list-inside">${suggestedCrops.map(c => `<li>${c}</li>`).join('')}</ul>`;
            if(soilOverride) speak(resultText);
        } else {
            allElements.cropResult.innerHTML = `<p>рдЗрд╕ рд╕рдВрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдлрд╕рд▓ рдирд╣реАрдВ рдорд┐рд▓реАред</p>`;
            if(soilOverride) speak("рдЗрд╕ рд╕рдВрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдлрд╕рд▓ рдирд╣реАрдВ рдорд┐рд▓реАред");
        }
    };
    
    const getFertilizerInfo = (cropOverride = null) => {
        const cropName = cropOverride || document.getElementById('fertilizerCrop').value;
        if(cropOverride) document.getElementById('fertilizerCrop').value = cropName;

        const data = cropDatabase[cropName];
        if (!data) return;

        let totalCost = 0;
        let speakText = `${cropName} рдХреЗ рд▓рд┐рдП, `;
        let fertilizerHtml = data.fertilizer.map(f => {
            const price = fertilizerPrices[f.n] || 0;
            const cost = price * f.q;
            totalCost += cost;
            speakText += `${f.q} рдХрд┐рд▓реЛрдЧреНрд░рд╛рдо ${f.n}, `;
            return `<li class="flex justify-between"><span>- ${f.n} (${f.q} kg)</span> <span class="font-semibold">~тВ╣${cost.toLocaleString('en-IN')}</span></li>`;
        }).join('');

        const resultHtml = `<div class="p-3 bg-blue-50 rounded-lg mb-3">
                              <h4 class="font-bold text-blue-800">рдЙрд░реНрд╡рд░рдХ рд╕реБрдЭрд╛рд╡ (рдкреНрд░рддрд┐ рдПрдХрдбрд╝):</h4>
                              <ul class="text-sm list-none space-y-1 mt-2">${fertilizerHtml}</ul>
                              <hr class="my-2"><p class="flex justify-between font-bold"><span>рдХреБрд▓ рд▓рд╛рдЧрдд</span><span>~тВ╣${totalCost.toLocaleString('en-IN')}</span></p>
                           </div>
                           <div class="p-3 bg-yellow-50 rounded-lg">
                              <h4 class="font-bold text-yellow-800">рдЯрд┐рдХрд╛рдК рдЦреЗрддреА:</h4>
                              <p class="text-sm">${data.sustainable}</p>
                           </div>`;
        allElements.fertilizerResult.innerHTML = resultHtml;
        if (cropOverride) speak(speakText + `рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред`);
    };

    const generateCalendar = (cropOverride = null) => {
        const crop = cropOverride || document.getElementById('calendarCrop').value;
        if(cropOverride) document.getElementById('calendarCrop').value = crop;

        const dateStr = document.getElementById('sowingDate').value;
        if (!dateStr) { 
            showMessage("рдХреГрдкрдпрд╛ рдмреБрд╡рд╛рдИ рдХреА рддрд╛рд░реАрдЦ рдЪреБрдиреЗрдВред", "error");
            if (!cropOverride) speak("рдХреГрдкрдпрд╛ рдкрд╣рд▓реЗ рдмреБрд╡рд╛рдИ рдХреА рддрд╛рд░реАрдЦ рдЪреБрдиреЗрдВред");
            else speak(`${crop} рдХрд╛ рдХреИрд▓реЗрдВрдбрд░ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ рдмреБрд╡рд╛рдИ рдХреА рддрд╛рд░реАрдЦ рдЪреБрдиреЗрдВ рдФрд░ рдлрд┐рд░ рдмрдЯрди рджрдмрд╛рдПрдВред`);
            return;
        }
        const startDate = new Date(dateStr);
        const data = cropDatabase[crop];
        
        allElements.modalTitle.innerText = `${crop} - рдлрд╕рд▓ рдХреИрд▓реЗрдВрдбрд░`;
        let content = `<div class="timeline">` + data.calendar.map(item => {
            const taskDate = new Date(startDate);
            taskDate.setDate(startDate.getDate() + (item.w * 7));
            const icon = ICONS[item.c] || ICONS['action'];
            const categoryColor = { fertilizer: 'bg-yellow-400', irrigation: 'bg-blue-400', pest_control: 'bg-red-400', harvest: 'bg-green-400', action: 'bg-gray-400'}[item.c];

            return `<div class="timeline-item">
                       <div class="timeline-icon ${categoryColor}">${icon}</div>
                       <div class="timeline-content">
                           <p class="timeline-category">рд╕рдкреНрддрд╛рд╣ ${item.w} (${taskDate.toLocaleDateString('hi-IN', {day:'2-digit', month:'short'})})</p>
                           <p>${item.t}</p>
                       </div>
                   </div>`;
        }).join('') + `</div>`;
        
        allElements.modalContent.innerHTML = content;
        allElements.calendarModal.classList.remove('hidden');
        allElements.calendarModal.classList.add('flex');
    };
    
    const diagnosePlant = () => {
        const fileInput = document.getElementById('plantPhotoInput');
        if (!fileInput.files || fileInput.files.length === 0) {
            showMessage("рдХреГрдкрдпрд╛ рдПрдХ рдлреЛрдЯреЛ рдЪреБрдиреЗрдВред", "error");
            return;
        }

        allElements.diagnosisResult.innerHTML = `<div class="flex items-center gap-2"><div class="loader !w-6 !h-6"></div><p>рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ...</p></div>`;
        
        setTimeout(() => {
            const diseases = [
                { name: "рд▓реАрдл рдХрд░реНрд▓ рд╡рд╛рдпрд░рд╕", remedy: "рд╕рдлреЗрдж рдордХреНрдЦреА рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдЗрдорд┐рдбрд╛рдХреНрд▓реЛрдкреНрд░рд┐рдб рдХрд╛ рдЫрд┐рдбрд╝рдХрд╛рд╡ рдХрд░реЗрдВред", confidence: 92 },
                { name: "рдкрд╛рдЙрдбрд░реА рдорд┐рд▓реНрдбреНрдпреВ", remedy: "рд╕рд▓реНрдлрд░ рдЖрдзрд╛рд░рд┐рдд рдлрдлреВрдВрджрдирд╛рд╢рдХ рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВред", confidence: 88 },
                { name: "рдирд╛рдЗрдЯреНрд░реЛрдЬрди рдХреА рдХрдореА", remedy: "рдпреВрд░рд┐рдпрд╛ рдХреА рдЯреЙрдк рдбреНрд░реЗрд╕рд┐рдВрдЧ рдХрд░реЗрдВ рдпрд╛ NPK рдШреЛрд▓ рдХрд╛ рдЫрд┐рдбрд╝рдХрд╛рд╡ рдХрд░реЗрдВред", confidence: 95 }
            ];
            const result = diseases[Math.floor(Math.random() * diseases.length)];
            allElements.diagnosisResult.innerHTML = `<div class="p-2 bg-yellow-50 rounded-lg">
                <p><span class="font-bold">рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛:</span> ${result.name} (${result.confidence}% рд╕рдВрднрд╛рд╡рдирд╛)</p>
                <p><span class="font-bold">рд╕реБрдЭрд╛рд╡:</span> ${result.remedy}</p>
            </div>`;
        }, 2000);
    };

    const getMarketPrice = () => {
        const crop = document.getElementById('marketCropSelect').value;
        const city = document.getElementById('cityInputMarket').value || "рдкреНрд░рдореБрдЦ рдордВрдбреА";
        const basePrice = cropDatabase[crop].base_price;
        const currentPrice = basePrice + Math.floor(Math.random() * (basePrice * 0.1) - (basePrice * 0.05));
        const trend = Math.random() > 0.5 ? "рдмрдврд╝рдиреЗ" : "рд╕реНрдерд┐рд░ рд░рд╣рдиреЗ";

        allElements.marketPriceResult.innerHTML = `<div class="p-2 bg-gray-100 rounded-lg">
            <p>${city} рдореЗрдВ ${crop} рдХрд╛ рд╡рд░реНрддрдорд╛рди рдФрд╕рдд рдореВрд▓реНрдп:</p>
            <p class="text-xl font-bold text-green-700">тВ╣ ${currentPrice.toLocaleString('en-IN')} / рдХреНрд╡рд┐рдВрдЯрд▓</p>
            <p class="text-sm mt-2">рдЕрдЧрд▓реЗ 7 рджрд┐рдиреЛрдВ рдореЗрдВ рдХреАрдорддреЛрдВ рдХреЗ ${trend} рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред</p>
        </div>`;
    };

    const predictYield = () => {
        const crop = document.getElementById('yieldCrop').value;
        const size = parseFloat(document.getElementById('farmSize').value) || 0;
        if (size <= 0) {
            showMessage("рдХреГрдкрдпрд╛ рдЦреЗрдд рдХрд╛ рдЖрдХрд╛рд░ рджрд░реНрдЬ рдХрд░реЗрдВред", "error");
            return;
        }
        const baseYield = cropDatabase[crop].base_yield;
        const predictedYield = (baseYield * size).toFixed(2);
        allElements.yieldResult.innerHTML = `<div class="p-2 bg-green-50 rounded-lg text-center">
            <p>рдЕрдиреБрдорд╛рдирд┐рдд рдЙрдкрдЬ:</p>
            <p class="text-xl font-bold">${predictedYield} рдХреНрд╡рд┐рдВрдЯрд▓</p>
        </div>`;
    };

    const updateLedger = () => {
        let total = 0;
        allElements.transactionList.innerHTML = '';
        ledger.forEach(t => {
            total += t.amount;
            const item = document.createElement('div');
            item.className = `flex justify-between p-1 rounded ${t.amount > 0 ? 'bg-green-100' : 'bg-red-100'}`;
            item.innerHTML = `<span>${t.desc}</span><span>тВ╣ ${t.amount.toLocaleString('en-IN')}</span>`;
            allElements.transactionList.appendChild(item);
        });
        allElements.profitText.textContent = `тВ╣ ${total.toLocaleString('en-IN')}`;
        allElements.profitText.className = `text-2xl font-bold ${total >= 0 ? 'text-green-700' : 'text-red-600'}`;
    };

    const addTransaction = (type) => {
        const desc = document.getElementById('transactionDesc').value;
        let amount = parseFloat(document.getElementById('transactionAmount').value);
        if (!desc || isNaN(amount) || amount <= 0) {
            showMessage("рдХреГрдкрдпрд╛ рд╕рд╣реА рд╡рд┐рд╡рд░рдг рдФрд░ рд░рд╛рд╢рд┐ рджрд░реНрдЬ рдХрд░реЗрдВред", "error");
            return;
        }
        if (type === 'expense') amount = -amount;
        ledger.push({ desc, amount });
        updateLedger();
        document.getElementById('transactionDesc').value = '';
        document.getElementById('transactionAmount').value = '';
    };

    const postToForum = () => {
        const question = document.getElementById('forumQuestion').value;
        if (!question.trim()) {
             showMessage("рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рд▓рд┐рдЦреЗрдВред", "error");
             return;
        }
        const post = document.createElement('div');
        post.className = "p-3 bg-blue-50 rounded-lg";
        post.innerHTML = `<p class="font-bold text-sm">рдЖрдкрдиреЗ рдкреВрдЫрд╛:</p><p class="text-sm">${question}</p>`;
        allElements.forumPosts.appendChild(post);
        document.getElementById('forumQuestion').value = '';
        allElements.forumPosts.scrollTop = allElements.forumPosts.scrollHeight;
    };

    const calculateTotalCost = () => {
        const ids = ["cost_seed", "cost_fertilizer", "cost_pesticide", "cost_labor", "cost_irrigation", "cost_other"];
        const total = ids.reduce((sum, id) => {
            const value = parseFloat(document.getElementById(id).value) || 0;
            return sum + value;
        }, 0);
        allElements.totalCostResult.innerHTML = `рдХреБрд▓ рдЕрдиреБрдорд╛рдирд┐рдд рд▓рд╛рдЧрдд: <span class="text-blue-700">тВ╣ ${total.toLocaleString('en-IN')}</span>`;
    };
    
    function handleVoiceCommand(transcript) {
        console.log("Transcript:", transcript);
        transcript = transcript.toLowerCase();

        if (transcript.includes('рдореМрд╕рдо')) {
            const cities = ["рджрд┐рд▓реНрд▓реА", "рдореБрдВрдмрдИ", "рдкреБрдгреЗ", "рдЬрдпрдкреБрд░", "рд▓рдЦрдирдК", "рдкрдЯрдирд╛", "рднреЛрдкрд╛рд▓", "рдЗрдВрджреМрд░", "рдЧреНрд░реЗрдЯрд░ рдиреЛрдПрдбрд╛"];
            let foundCity = null;
            cities.forEach(city => {
                if (transcript.includes(city.toLowerCase())) {
                    foundCity = city;
                }
            });
            if (foundCity) {
                speak(`${foundCity} рдХрд╛ рдореМрд╕рдо рджрд┐рдЦрд╛ рд░рд╣рд╛ рд╣реВрдБред`);
                fetchWeather(foundCity);
            } else {
                speak("рдХреГрдкрдпрд╛ рд╢рд╣рд░ рдХрд╛ рдирд╛рдо рдмрддрд╛рдПрдВред");
            }
            return;
        }

        if (transcript.includes('рдлрд╕рд▓ рдмрддрд╛рдУ') || transcript.includes('рдлрд╕рд▓ рд╕реБрдЭрд╛рдУ')) {
            const soils = { "рдХрд╛рд▓реА": "рдХрд╛рд▓реА", "рдЬрд▓реЛрдврд╝": "рдЬрд▓реЛрдврд╝", "рд▓рд╛рд▓": "рд▓рд╛рд▓", "рд▓реЗрдЯрд░рд╛рдЗрдЯ": "рд▓реЗрдЯрд░рд╛рдЗрдЯ" };
            const seasons = { "рд░рдмреА": "рд░рдмреА", "рдЦрд░реАрдл": "рдЦрд░реАрдл", "рдЬрд╛рдпрдж": "рдЬрд╛рдпрдж" };
            let foundSoil = null, foundSeason = null;
            Object.keys(soils).forEach(s => { if(transcript.includes(s)) foundSoil = soils[s]; });
            Object.keys(seasons).forEach(s => { if(transcript.includes(s)) foundSeason = seasons[s]; });
            
            if (foundSoil && foundSeason) {
                speak(`${foundSoil} рдорд┐рдЯреНрдЯреА рдФрд░ ${foundSeason} рдореМрд╕рдо рдХреЗ рд▓рд┐рдП рдлрд╕рд▓ рдмрддрд╛ рд░рд╣рд╛ рд╣реВрдБред`);
                getCropAdvice(foundSoil, foundSeason);
            } else {
                speak("рдлрд╕рд▓ рд╕реБрдЭрд╛рд╡ рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ рдорд┐рдЯреНрдЯреА рдХрд╛ рдкреНрд░рдХрд╛рд░ рдФрд░ рдореМрд╕рдо рдмрддрд╛рдПрдВред рдЬреИрд╕реЗ, 'рдХрд╛рд▓реА рдорд┐рдЯреНрдЯреА рдФрд░ рдЦрд░реАрдл рдХреЗ рд▓рд┐рдП рдлрд╕рд▓ рдмрддрд╛рдУ'");
            }
            return;
        }

        if (transcript.includes('рдХреИрд▓реЗрдВрдбрд░')) {
            let foundCrop = null;
            Object.keys(cropDatabase).forEach(crop => {
                if (transcript.includes(crop.toLowerCase())) {
                    foundCrop = crop;
                }
            });
            if (foundCrop) {
                generateCalendar(foundCrop);
            } else {
                speak("рдХреГрдкрдпрд╛ рдлрд╕рд▓ рдХрд╛ рдирд╛рдо рдмрддрд╛рдПрдВ рдЬрд┐рд╕рдХрд╛ рдХреИрд▓реЗрдВрдбрд░ рдЖрдк рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред");
            }
            return;
        }

        if (transcript.includes('рдЦрд╛рдж')) {
            let foundCrop = null;
            Object.keys(cropDatabase).forEach(crop => {
                if (transcript.includes(crop.toLowerCase())) {
                    foundCrop = crop;
                }
            });
            if (foundCrop) {
                speak(`${foundCrop} рдХреЗ рд▓рд┐рдП рдЦрд╛рдж рдХреА рдЬрд╛рдирдХрд╛рд░реА рджреЗ рд░рд╣рд╛ рд╣реВрдБред`);
                getFertilizerInfo(foundCrop);
            } else {
                speak("рдХреГрдкрдпрд╛ рдлрд╕рд▓ рдХрд╛ рдирд╛рдо рдмрддрд╛рдПрдВ рдЬрд┐рд╕рдХреА рдЦрд╛рдж рдХреА рдЬрд╛рдирдХрд╛рд░реА рдЪрд╛рд╣рд┐рдПред");
            }
            return;
        }
        
        speak("рдорд╛рдлрд╝ рдХреАрдЬрд┐рдпреЗ, рдореИрдВ рд╕рдордЭ рдирд╣реАрдВ рдкрд╛рдпрд╛ред рдХреНрдпрд╛ рдЖрдк рджреЛрд╣рд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ?");
    }

    // --- EVENT LISTENERS ---
    if (recognition) {
        allElements.assistantBtn.addEventListener('click', () => {
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        });

        recognition.onstart = () => {
            isListening = true;
            allElements.status.textContent = "рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ...";
            allElements.assistantBtn.classList.add('assistant-btn-glow');
            speak("рдирдорд╕реНрддреЗ, рдореИрдВ рд╣рд░рд┐рдд рд╣реВрдБред рдЖрдк рдХреНрдпрд╛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?");
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            allElements.status.textContent = `рдЖрдкрдиреЗ рдХрд╣рд╛: ${transcript}`;
            handleVoiceCommand(transcript);
        };

        recognition.onerror = (event) => {
            console.error(event.error);
            allElements.status.textContent = "рдПрдХ рддреНрд░реБрдЯрд┐ рд╣реБрдИ, рдХреГрдкрдпрд╛ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред";
        };

        recognition.onend = () => {
            isListening = false;
            allElements.status.textContent = "";
            allElements.assistantBtn.classList.remove('assistant-btn-glow');
        };
    } else {
        allElements.status.textContent = "рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡реЙрдпрд╕ рдЕрд╕рд┐рд╕реНрдЯреЗрдВрдЯ рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред";
    }
    
    allElements.getWeatherBtn.addEventListener('click', () => fetchWeather());
    allElements.getCropBtn.addEventListener('click', () => getCropAdvice());
    allElements.getFertilizerBtn.addEventListener('click', () => getFertilizerInfo());
    allElements.generateCalendarBtn.addEventListener('click', () => generateCalendar());
    allElements.diagnoseBtn.addEventListener('click', diagnosePlant);
    allElements.getMarketPriceBtn.addEventListener('click', getMarketPrice);
    allElements.predictYieldBtn.addEventListener('click', predictYield);
    allElements.addIncomeBtn.addEventListener('click', () => addTransaction('income'));
    allElements.addExpenseBtn.addEventListener('click', () => addTransaction('expense'));
    allElements.postQuestionBtn.addEventListener('click', postToForum);
    allElements.calculateCostBtn.addEventListener('click', calculateTotalCost);
    
    allElements.openCostCalculatorBtn.addEventListener('click', () => allElements.costCalculatorModal.classList.remove('hidden'));
    allElements.closeCostModalBtn.addEventListener('click', () => allElements.costCalculatorModal.classList.add('hidden'));
    allElements.closeCalendarModalBtn.addEventListener('click', () => allElements.calendarModal.classList.add('hidden'));

    // --- INITIALIZATION ---
    populateDropdowns();
    document.getElementById('sowingDate').valueAsDate = new Date();
});
</script>
</body>
</html>
